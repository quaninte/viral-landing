{% extends '@BKCore/layout.html.twig' %}

{% block head_scripts %}
    <!-- Facebook Conversion Code for Beeketing beta signup -->
    <script>(function() {
            var _fbq = window._fbq || (window._fbq = []);
            if (!_fbq.loaded) {
                var fbds = document.createElement('script');
                fbds.async = true;
                fbds.src = '//connect.facebook.net/en_US/fbds.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(fbds, s);
                _fbq.loaded = true;
            }
        })();
        window._fbq = window._fbq || [];
        window._fbq.push(['track', '6014871780461', {'value':'0.00','currency':'USD'}]);
    </script>
    <noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?ev=6014871780461&amp;cd[value]=0.00&amp;cd[currency]=USD&amp;noscript=1" /></noscript>
{% endblock head_scripts %}

{% block container_class %}text-center thank{% endblock %}

{% block main_content %}
    {% set shareUrl = url('bk_core_homepage', { 'ref': contact.code }) %}

        <p class="referral">You are #{{ contact.position }} on our waiting list.</p>

        <h1 class="big-award">Want to cut in line and get $200 credit to use Beeketing?</h1>

        <br>
        <p class="referral">Get 5 of your friends to sign up with this unique URL:</p>

        <br>
        <p><b>{{ url('bk_core_homepage', { 'ref': contact.code }) }}</b></p>
        <br>

        <div class="row">
            <div class="col-md-6 col-md-offset-3 text-center share-btns">
                <a class="share-facebook" href="http://www.facebook.com/share.php?u={{ shareUrl | url_encode }}&amp;title=Can't wait for #Beeketing, the first virtual marketer ever. Now accepting beta users." target="_blank">
                    <img src="{{ asset('bundles/bkcore/images/shareon.png') }}">
                </a>
                <a class="share-twitter" href="http://twitter.com/home?status=Can't wait for @beeketing, the first virtual marketer ever! Sign up for beta now: +{{ shareUrl | url_encode }}" target="_blank">
                    <img src="{{ asset('bundles/bkcore/images/tweeton.png') }}">
                </a>
            </div>	</div>

        <p style="margin-top: 1rem;">So far, you have <b>{{ invited }}</b> referrals.</p>
{% endblock main_content %}

{% block foot_scripts %}
    {{ parent() }}

    <script type="text/javascript">
        // segment io
        window.analytics=window.analytics||[],window.analytics.methods=["identify","group","track","page","pageview","alias","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(t){if(!document.getElementById("analytics-js")){var a=document.createElement("script");a.type="text/javascript",a.id="analytics-js",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.io/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},window.analytics.SNIPPET_VERSION="2.0.9",
        window.analytics.load("{{ segmentio_writekey }}");

        analytics.identify('{{ contact.id }}', {
            email: '{{ contact.email }}',
            code: '{{ contact.code }}',
            invited: '{{ invited }}',
            position: '{{ contact.position }}'
        });

        // customer io
        var _cio = _cio || [];
        (function() {
            var a,b,c;a=function(f){return function(){_cio.push([f].
                    concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
                "sidentify","track","page"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
            var t = document.createElement('script'),
                    s = document.getElementsByTagName('script')[0];
            t.async = true;
            t.id    = 'cio-tracker';
            t.setAttribute('data-site-id', '{{ customerio_id }}');
            t.src = 'https://assets.customer.io/assets/track.js';
            s.parentNode.insertBefore(t, s);
        })();
        _cio.identify({
            id: '{{ contact.id }}',
            email: '{{ contact.email }}',
            created_at: {{ contact.created | date('U') }},
            code: '{{ contact.code }}',
            invited: '{{ invited }}',
            position: '{{ contact.position }}'
        });

        $(function() {
            $('.share-facebook').click(function() {
                analytics.track('Start Share Facebook');
            });

            $('.share-twitter').click(function() {
                analytics.track('Start Share Twitter');
            });
        });
    </script>
{% endblock foot_scripts %}